<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %} - DreamLoop</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .dream-card {
            @apply bg-white/80 rounded-xl shadow-lg backdrop-blur-sm transition-all duration-300;
        }
        .dream-button {
            @apply px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-300;
        }
        .dream-tag {
            @apply px-3 py-1 rounded-full text-sm font-medium;
        }
        .dream-tag-mood {
            @apply bg-purple-100 text-purple-800;
        }
        .dream-tag-regular {
            @apply bg-pink-100 text-pink-800;
        }
        .feature-box {
            @apply bg-white/60 backdrop-blur-sm rounded-xl p-6 hover:shadow-lg transition-all duration-300;
        }
        .section-divider {
            @apply my-6 border-t border-slate-200;
        }
        .comment-card {
            @apply bg-white/60 rounded-lg p-6 hover:bg-white/80 transition-all duration-300 space-y-3;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50">
    <nav class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="{{ url_for('index') }}" class="flex items-center">
                            <img src="{{ url_for('static', filename='dreamlooplogo.png') }}" alt="DreamLoop Logo" class="h-10">
                        </a>
                    </div>
                    {% if current_user.is_authenticated %}
                    <div class="hidden md:ml-6 md:flex md:space-x-4 items-center">
                        <a href="{{ url_for('dream_new') }}" class="text-slate-700 hover:text-slate-900 px-3 py-2 rounded-md transition-colors">
                            Log Dream
                        </a>
                        <a href="{{ url_for('community') }}" class="text-slate-700 hover:text-slate-900 px-3 py-2 rounded-md transition-colors">
                            Community
                        </a>
                        <a href="{{ url_for('dream_patterns') }}" class="text-slate-700 hover:text-slate-900 px-3 py-2 rounded-md transition-colors">
                            Patterns
                        </a>
                    </div>
                    {% endif %}
                </div>
                <div class="flex items-center">
                    {% if current_user.is_authenticated %}
                    <div class="flex items-center space-x-4">
                        {% if current_user.subscription_type == 'free' %}
                        <a href="{{ url_for('subscription') }}" class="dream-button">
                            Upgrade to Premium
                        </a>
                        {% endif %}
                        <div class="relative">
                            <button id="userMenu" class="flex items-center text-slate-700 hover:text-slate-900">
                                <span class="mr-2">{{ current_user.username }}</span>
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div id="userDropdown" class="hidden absolute right-0 mt-2 py-2 w-48 bg-white rounded-lg shadow-xl">
                                <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-slate-700 hover:bg-slate-100">
                                    Sign out
                                </a>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="flex items-center space-x-4">
                        <a href="{{ url_for('login') }}" class="text-slate-700 hover:text-slate-900">Sign in</a>
                        <a href="{{ url_for('register') }}" class="dream-button">
                            Get Started
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <main class="py-8">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="container mx-auto px-4 mb-8">
            {% for message in messages %}
            <div class="bg-white/80 backdrop-blur-sm border-l-4 border-purple-500 p-4 rounded-lg">
                <p class="text-slate-700">{{ message }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <script>
        // User menu dropdown toggle
        const userMenu = document.getElementById('userMenu');
        const userDropdown = document.getElementById('userDropdown');
        
        if (userMenu && userDropdown) {
            userMenu.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!userDropdown.contains(e.target)) {
                    userDropdown.classList.add('hidden');
                }
            });
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
